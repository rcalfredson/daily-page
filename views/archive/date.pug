extends ../layout

include ../partials/_read_more
include ../partials/_translation_attribution

block nav
  include ../navLinks

block append head
  link(rel='stylesheet' href='/css/blocks-dashboard.css')
  link(rel='stylesheet' href='/css/archive.css')
  link(rel='stylesheet' href='/css/pagination.css')
  link(rel='stylesheet' href='/css/vote-controls.css')
  link(rel='stylesheet' href='/css/toast.css')
  link(rel='stylesheet' href='/css/modal.css')
  link(rel='stylesheet' href='/css/translation-attribution.css')
  link(rel='stylesheet' href='/css/table-scroll-fade.css')
  - const prevHref = prevDate ? (roomId ? `/rooms/${roomId}/archive/${prevDate.split('-').join('/')}` : `/archive/${prevDate.split('-').join('/')}`) : null
  - const nextHref = nextDate ? (roomId ? `/rooms/${roomId}/archive/${nextDate.split('-').join('/')}` : `/archive/${nextDate.split('-').join('/')}`) : null
  if prevHref
    link(rel="prev" href=uiPath(prevHref))
  if nextHref
    link(rel="next" href=uiPath(nextHref))

block append scripts
  script(src='/js/toast-utils.js')
  script(src='/js/vote-controls.js')
  script(src='/js/modal.js')
  script(src='/js/table-scroll-fade.js')

block content
  .archive-container
    include ../partials/_archiveNav
    +archiveNav(
      prevHref ? uiPath(prevHref) : null,
      prevDate || '',
      nextHref ? uiPath(nextHref) : null,
      nextDate || '',
      'archive-nav'
    )
    if roomId
      h1
        a.room-link(href=uiPath(`/rooms/${roomId}`) title=roomName)= roomName
        |  â€” 
        = t('archive.date.heading', { date })
    else
      h1= t('archive.date.heading', { date })

    if blocks.length
      ul.block-list
        each block in blocks
          li.block-item(lang=(block.lang || 'en'))
            div.block-main
              a.block-link(href=`/rooms/${block.roomId}/blocks/${block._id}` lang=(block.lang || 'en'))= block.title
              .block-meta(lang=(uiLang || 'en'))
                | #{t('archive.date.labels.createdBy')} 
                a.user-profile-link(href=uiPath(`/users/${block.creator}`))= block.creator
                |  #{t('archive.date.labels.in')} 
                a.room-link(href=uiPath(`/rooms/${block.roomId}`))= block.roomDisplayName || block.roomId || t('archive.date.labels.unknownRoom')
                |  #{t('archive.date.labels.on', { datetime: formatDateTime(block.createdAt) })}
              +translationAttribution(block)
              div(class=['content-preview', {'fade-footer': block.truncated}], lang=(block.lang || 'en'))!= block.contentHTML
            +readMoreIfTruncated(block, block.roomId)
            footer.block-footer
              include ../partials/_vote_controls
    else
      p= t('archive.date.empty')
  include ../partials/_pagination
  - const pageBase = roomId ? `/rooms/${roomId}/archive/${dateISO.split('-').join('/')}` : `/archive/${dateISO.split('-').join('/')}`
  +pagination(currentPage, totalPages, uiPath(pageBase))

  include ../partials/_login_modal
  #toast-container
