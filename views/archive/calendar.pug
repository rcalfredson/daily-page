extends ../layout

block nav
  include ../navLinks

block append head
  link(rel='stylesheet' href='/css/archive-calendar.css')
  link(rel='stylesheet' href='/css/archive-breadcrumbs.css')

  - const prevHref = prevMonth ? (roomId ? `/rooms/${roomId}/archive/${prevMonth.year}/${prevMonth.month}` : `/archive/${prevMonth.year}/${prevMonth.month}`) : null
  - const nextHref = nextMonth ? (roomId ? `/rooms/${roomId}/archive/${nextMonth.year}/${nextMonth.month}` : `/archive/${nextMonth.year}/${nextMonth.month}`) : null

  if prevHref
    link(rel="prev" href=uiPath(prevHref))
  if nextHref
    link(rel="next" href=uiPath(nextHref))

block content
  if roomId
    .archive-room-meta
      p 
        = t('archive.roomViewing', { roomName })
        |  Â· 
        a(href=uiPath(`/rooms/${roomId}`))= t('archive.viewRoomLink')
  .calendar-container
    include ../partials/_archiveNav
    +archiveNav(
      prevHref ? uiPath(prevHref) : null,
      prevMonth ? t('archive.calendar.prevLabel', { month: monthName(prevMonth.month), year: prevMonth.year }) : '',
      nextHref ? uiPath(nextHref) : null,
      nextMonth ? t('archive.calendar.nextLabel', { month: monthName(nextMonth.month), year: nextMonth.year }) : '',
      'block-nav'
    )
    h1= t('archive.calendar.title', { month: monthName(month), year })

    table.calendar
      thead
        tr
          // Nota: weekdaysShort viene ya localizado desde la ruta
          each day in weekdaysShort
            th= day
      tbody
        - const firstDay = new Date(Date.UTC(year, month - 1, 1)).getUTCDay()
        - const daysInMonth = new Date(Date.UTC(year, month, 0)).getUTCDate()
        - let dayCount = 1
        while dayCount <= daysInMonth
          tr
            each dayOfWeek in Array(7).fill().map((_, idx) => idx)
              if (dayCount === 1 && dayOfWeek < firstDay) || dayCount > daysInMonth
                td.empty-cell
              else
                - const monthPadded = String(month).padStart(2, '0');
                - const dayPadded = String(dayCount).padStart(2, '0');
                - const currentDate = `${year}-${monthPadded}-${dayPadded}`
                if datesWithContent.includes(currentDate)
                  - const dest = roomId ? `/rooms/${roomId}/archive/${year}/${monthPadded}/${dayPadded}` : `/archive/${year}/${monthPadded}/${dayPadded}`
                  td.active-day
                    a(href=uiPath(dest))= dayCount
                else
                  td.inactive-day= dayCount
                - dayCount++
  if roomId
    .back-to-room-link
      a(href=uiPath(`/rooms/${roomId}`))= t('archive.backToRoom')
